---
import AppLayout from '@/layouts/AppLayout.astro';
import { getUser, createSupabaseServerClient } from '@/lib/auth';
import ProfileForm from '@/components/auth/ProfileForm.vue';

// Get current user
const user = await getUser(Astro.cookies);

if (!user) {
  return Astro.redirect('/login');
}

// Get profile from database
const supabase = createSupabaseServerClient(Astro.cookies);
const { data: profile } = await supabase.from('profiles').select('*').eq('id', user.id).single();
---

<AppLayout title="Profile - Balance Pal">
  <div class="mx-auto max-w-2xl p-4 md:p-6 lg:p-8">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-2xl font-bold text-gray-900 md:text-3xl">Profile</h1>
      <p class="mt-1 text-gray-600">Manage your account settings</p>
    </div>

    <!-- Profile Card -->
    <div class="rounded-xl border border-gray-100 bg-white shadow-sm">
      <div class="p-6">
        <ProfileForm
          client:load
          initialName={profile?.name ?? user.email?.split('@')[0] ?? ''}
          email={user.email ?? ''}
          avatarUrl={profile?.avatar_url ?? null}
        />
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="border-danger-500/30 mt-8 rounded-xl border bg-white shadow-sm">
      <div class="p-6">
        <h2 class="text-danger-500 mb-2 text-lg font-semibold">Danger Zone</h2>
        <p class="mb-4 text-sm text-gray-600">
          Once you delete your account, there is no going back. Please be certain.
        </p>
        <button
          class="btn bg-danger-500/10 text-danger-500 hover:bg-danger-500 transition-colors hover:text-white"
          onclick="alert('Account deletion coming soon')"
        >
          Delete Account
        </button>
      </div>
    </div>
  </div>
</AppLayout>
