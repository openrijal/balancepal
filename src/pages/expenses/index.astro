---
import AppLayout from '@/layouts/AppLayout.astro';
import AllExpensesList from '@/components/expenses/AllExpensesList.vue';
import { GroupService } from '@/services/groups';

// User is attached by middleware (already authenticated by middleware)
const user = Astro.locals.user!;

// Fetch user's groups for the filter
const groups = await GroupService.getUserGroups(user.id);
const groupsForFilter = groups.map((g) => ({ id: g.id, name: g.name }));
---

<AppLayout title="All Expenses - Balance Pal">
  <div class="mx-auto max-w-5xl p-4 md:p-6 lg:p-8">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-2xl font-bold text-gray-900 md:text-3xl">All expenses</h1>
      <p class="mt-1 text-gray-600">A consolidated view of all your group transactions.</p>
    </div>

    <AllExpensesList client:load currentUserId={user.id} groups={groupsForFilter} />
  </div>
</AppLayout>
